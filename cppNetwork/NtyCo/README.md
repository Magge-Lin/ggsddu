# 协程


## 1. 协程的优点
> 异步的执行效率，同步的编程方式。

## 2. 协程的原语操作
> resume    ：让出当前操作
> 
> yield     ：恢复当前操作

## 3. 协程的切换

### 3.1协程的三种切换方式
- setjmp/longjmp
    > context保存当前协程的寄存器，加载另一个协程的相关寄存器.
    >
    > 学习一下 setjmp.h 头文件的函数用法，进行上下文切换。
    >
    > 调用例子放在：src/setjmp.c
- ucontext
    > linux 内核提供: 上下文环境
    >
    > 学习一下 ucontext.h 头文件的函数用法，进行上下文切换。
    >
    >  调用例子放在：src/Ucontext.c
- asm code
    > 汇编代码
    >
    > 参考资料：
    >
    > ​	doc/X86-64寄存器和栈帧.pdf
    > 优缺点：
    >
    > ​	优点是性能较高，缺点是跨平台较弱
    > 步骤：
    > ​	1、定义一个数据结构用于保存协程的上下文信息，例如寄存器状态、栈指针等。
    >
    > ​	2、在每个协程执行之前，保存当前协程的上下文到该数据结构中，并将其作为参数传递给协程调度器。
    >
    > ​	3、协程调度器负责在不同的协程之间进行切换。它会根据调度算法选择下一个要执行的协程，并将其上下文恢复到对应寄存器和栈中。
    >
    > ​	4、使用汇编指令来保存和恢复寄存器状态，以及修改堆栈指针。这包括了 push 和 pop 指令用于保存和恢复寄存器值，以及 call 指令来跳转到新的函数执行。

## 3. 协程的调度器
> 了解了寄存器上下文切换，以编程经验和代码设计的角度看，还需要一个调度器去实现协程的管理，切换时机，切换给谁，啥时候切换回来，切换回来IO是否准备就绪，等问题需要实现一个调度器来进行管理。

## 4. 


回家吃饭.